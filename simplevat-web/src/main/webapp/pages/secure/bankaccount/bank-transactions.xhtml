<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:si="http://java.sun.com/jsf/composite/ccomponent"
                template="/WEB-INF/templates/template.xhtml">

    <ui:define name="title">#{messages.bank_accounts}</ui:define>

    <ui:define name="content">
        <style>

            .status-label{
                font-size: 75%;
                line-height: 20px;
                float: left;
                padding-left: 2px;
            }
            .explained {
                color: #037b03;
                display: inherit;
            }
            .explained:after {
                content: 'Explained';
                vertical-align: middle;
                display: inline;
            }
            .unexplained {
                color: #ff0000;
                display: inherit;
            }
            .unexplained:after {
                content: 'Unexplained';
                vertical-align: middle;
                display: inline;
            }
            .ui-row-toggler{
                display: inline !important;
                float: left;
            }
            .explained-block .ui-row-toggler{
                color: #037b03 !important;
            }
            .unexplained-block .ui-row-toggler{
                color: #ff0000 !important;
            }
        </style>

        <h:form>
            <si:cdataPanel newAction= "#{transactionController.createTransaction()}" importAction="#{transactionController.importTransaction()}">
                <p:dataTable var="transaction"
                             id="transactionsTable"
                             value="#{transactionListController.transactions}"
                             paginator="true" rows="10" rowExpandMode="single" 
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {TableHeader}">
                    <f:facet name="{TableHeader}">
                        <p:outputLabel styleClass="tableCustomHeader" value="#{transactionListController.selectedBankAccountModel.bankAccountName}" />
                    </f:facet>

                    <p:column width="80" style="text-align: center">

                        <h:panelGroup rendered="#{transaction.transactionStatus.explainationStatusName eq 'EXPLAINED'}">
                            <i class="fa fa-check" style="color: green;"></i>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{transaction.transactionStatus.explainationStatusName eq 'UNEXPLAINED'}">
                            <i class="fa fa-question" style="color: red;"></i>
                        </h:panelGroup>
                        <br/>
                        <p:rowToggler />
                        <h:panelGroup styleClass="explained-block" rendered="#{transaction.transactionStatus.explainationStatusName eq 'EXPLAINED'}" >
                            <h:panelGroup layout="block" styleClass="status-label explained">
                                <h:outputText value=" "/>
                            </h:panelGroup>
                        </h:panelGroup>
                        <h:panelGroup styleClass="unexplained-block" rendered="#{transaction.transactionStatus.explainationStatusName eq 'UNEXPLAINED'}">
                            <h:panelGroup layout="block" styleClass="status-label unexplained">
                                <h:outputText value=" "/>
                            </h:panelGroup>
                        </h:panelGroup>
                    </p:column>

                    <p:column headerText="#{messages.date}" sortBy="#{transaction.transactionDate.time}" filterMatchMode="contains" filterBy="#{transaction.transactionDate.time}">
                        <h:outputText value="#{transaction.transactionDate.time}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{messages.description}" filterMatchMode="contains" filterBy="#{transaction.transactionDescription}">
                        <p:outputLabel value="#{transaction.transactionDescription}"/>
                    </p:column>

                    <p:column headerText="#{messages.credit}" sortBy="#{transaction.transactionAmount}" styleClass="amount" filterMatchMode="contains" filterBy="#{transaction.transactionAmount}">
                        <h:outputText value="#{transaction.bankAccount.bankAccountCurrency.currencySymbol} " rendered="#{transaction.debitCreditFlag.toString() eq 'C'}" />
                        <h:outputText value="#{transaction.transactionAmount}" rendered="#{transaction.debitCreditFlag.toString() eq 'C'}" >
                            <f:convertNumber type="currency" currencySymbol=""/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{messages.debit}" sortBy="#{transaction.transactionAmount}" styleClass="amount" filterMatchMode="contains" filterBy="#{transaction.transactionAmount}">
                        <h:outputText value="#{transaction.bankAccount.bankAccountCurrency.currencySymbol} " rendered="#{transaction.debitCreditFlag.toString() eq 'D'}" />
                        <h:outputText value="#{transaction.transactionAmount}" rendered="#{transaction.debitCreditFlag.toString() eq 'D'}" >
                            <f:convertNumber type="currency" currencySymbol=""/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="#{messages.current_balance}" styleClass="amount" filterMatchMode="contains" filterBy="#{transaction.currentBalance}">
                        <h:outputText value="#{transaction.bankAccount.bankAccountCurrency.currencySymbol} " />
                        <h:outputText value="#{transaction.currentBalance}" >
                            <f:convertNumber type="currency" currencySymbol=""/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Action">

                        <p:commandButton icon="ui-icon-edit" styleClass="AquaButton" action="#{transactionController.editTransection}">
                            <f:setPropertyActionListener value="#{transaction}" target="#{transactionController.selectedTransactionModel}" />
                        </p:commandButton>

                        <p:commandButton icon="ui-icon-delete" styleClass="AquaButton" action="#{transactionController.deleteTransaction}" update="transactionsTable">
                            <f:setPropertyActionListener value="#{transaction}" target="#{transactionController.selectedTransactionModel}" />
                            <p:confirm header="#{messages.delete}" message="#{messages.are_you_sure_want_to_delete}" icon="ui-icon-alert" />
                        </p:commandButton>

                    </p:column>

                    <p:rowExpansion >
                        <p:panelGrid  columns="2"
                                      columnClasses="ui-grid-col-6,ui-grid-col-6"
                                      layout="grid" styleClass="ui-panelgrid-blank form-group ui-fluid"
                                      style="border:0px none; background-color:transparent; padding-top: 10px">

                            <h:panelGroup styleClass="md-inputfield">
                                <p:autoComplete
                                    id="transactionType"
                                    converter="#{transactionTypeConverter}"
                                    dropdown="true"
                                    forceSelection="true"
                                    effect="fold"
                                    completeMethod="#{transactionListController.transactionTypes()}"
                                    value="#{transaction.transactionType}"
                                    var="transactionType"
                                    itemValue="#{transactionType}"
                                    itemLabel="#{transactionType.transactionTypeName}">
                                </p:autoComplete>
                                <label>#{messages.type}</label>
                            </h:panelGroup>

                            <h:panelGroup styleClass="md-inputfield">
                                <p:autoComplete
                                    id="transactionCategory"
                                    converter="#{transactionCategoryConverter}"
                                    dropdown="true"
                                    forceSelection="true"
                                    effect="fold"
                                    completeMethod="#{transactionListController.transactionCategories}"
                                    value="#{transaction.explainedTransactionCategory}"
                                    var="transactionCategory"
                                    itemValue="#{transactionCategory}"
                                    itemLabel="#{transactionCategory.transactionCategoryName}">
                                </p:autoComplete>
                                <label>#{messages.category}</label>
                            </h:panelGroup>


                            <h:panelGroup styleClass="md-inputfield">
                                <p:inputText id="transactionDescription"
                                             value="#{transaction.transactionDescription}" />
                                <label>#{messages.description}</label>
                            </h:panelGroup>


                            <h:panelGroup styleClass="md-inputfield" >
                                <p:autoComplete
                                    id="transactionStatus"
                                    converter="#{transactionStatusConverter}"
                                    dropdown="true"
                                    forceSelection="true"
                                    effect="fold"
                                    completeMethod="#{transactionListController.transactionStatuses}"
                                    value="#{transaction.transactionStatus}"
                                    var="transactionStatus"
                                    itemValue="#{transactionStatus}"
                                    itemLabel="#{transactionStatus.explainationStatusName}">
                                </p:autoComplete>
                                <label>#{messages.status}</label>
                            </h:panelGroup>
                        </p:panelGrid>
                        <p:panelGrid columns="2" styleClass="ui-panelgrid-blank form-group"
                                     columnClasses="ui-grid-col-6,ui-grid-col-6">
                                     <p:commandButton value="#{messages.save}" icon="ui-icon-save" update="transactionsTable"
                                         action="#{transactionListController.updateTransactionDropDown()}">
                                <f:setPropertyActionListener target="#{transactionListController.transactionModel}" value="#{transaction}" />
                            </p:commandButton>
                        </p:panelGrid>

                    </p:rowExpansion>
                </p:dataTable>
            </si:cdataPanel>
        </h:form>
        <ui:include src="import-transaction-popup.xhtml"/>


    </ui:define>

</ui:composition>