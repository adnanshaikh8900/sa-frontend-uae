<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui"
     xmlns:si="http://java.sun.com/jsf/composite/ccomponent">
    <h:form>
        <p:dataTable var="tax"
                     value="#{taxTransactionController.taxTransactionList}"
                     rowIndexVar="index" 
                     paginator="true" rows="10"
                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {TableHeader} {TableFooter}"
                     id="taxHistoryTable">

            <f:facet name="{TableHeader}">
                <p:outputLabel styleClass="tableCustomHeader" value="Tax Transaction" />
            </f:facet>
            <f:facet name="{TableFooter}">
                <p:outputLabel styleClass="tableCustomFooter" value="Total Record: #{taxTransactionController.taxTransactionList.size()}" />
            </f:facet>

            <p:column headerText="Start Date" width="100" sortBy="#{tax.startDate}" filterMatchMode="contains" filterBy="#{tax.startDate}">
                <h:outputText value="#{tax.startDate}" >
                    <f:convertDateTime pattern="dd/MM/yyyy" />
                </h:outputText>
            </p:column>

            <p:column headerText="End Date" width="80" sortBy="#{tax.endDate}" filterMatchMode="contains" filterBy="#{tax.endDate}">
                <h:outputText value="#{tax.endDate}" >
                    <f:convertDateTime pattern="dd/MM/yyyy" />
                </h:outputText>
            </p:column>

            <p:column headerText="VAT IN" filterMatchMode="contains" width="80" styleClass="amount" filterBy="#{tax.vatIn}">
                <h:outputText value="#{tax.vatIn}">
                    <f:convertNumber type="currency" maxFractionDigits="2" currencySymbol="#{taxTransactionController.currency.currencySymbol}" />
                </h:outputText>
            </p:column>

            <p:column headerText="VAT OUT" filterMatchMode="contains" width="80" styleClass="amount" filterBy="#{tax.vatOut}">
                <h:outputText value="#{tax.vatOut}">
                    <f:convertNumber type="currency" maxFractionDigits="2" currencySymbol="#{taxTransactionController.currency.currencySymbol}" />
                </h:outputText>
            </p:column>

            <p:column headerText="Total" styleClass="amount" filterMatchMode="contains" filterBy="#{tax.vatIn - tax.vatOut}">
                <h:outputText value="#{tax.vatIn - tax.vatOut}" >
                    <f:convertNumber type="currency" maxFractionDigits="2" currencySymbol="#{taxTransactionController.currency.currencySymbol}" />
                </h:outputText>
            </p:column>

            <p:column headerText="Payment Date" sortBy="#{tax.paymentDate}" width="130" filterMatchMode="contains" filterBy="#{tax.paymentDate}">
                <h:outputText value="#{tax.paymentDate}" >
                    <f:convertDateTime pattern="dd/MM/yyyy" />
                </h:outputText>
            </p:column>

            <p:column headerText="Due Amount" styleClass="amount" filterMatchMode="contains" filterBy="#{tax.dueAmount}">
                <h:outputText value="#{tax.dueAmount}">
                    <f:convertNumber type="currency" maxFractionDigits="2" currencySymbol="#{taxTransactionController.currency.currencySymbol}" />
                </h:outputText>
            </p:column>

            <p:column headerText="Paid Amount" styleClass="amount" filterMatchMode="contains" filterBy="#{tax.paidAmount}">
                <h:outputText value="#{tax.paidAmount}">
                    <f:convertNumber type="currency" maxFractionDigits="2" currencySymbol="#{taxTransactionController.currency.currencySymbol}" />
                </h:outputText>
            </p:column>

            <p:column headerText="Status" filterMatchMode="contains" width="70" filterBy="#{tax.status}">
                <h:outputText value="#{tax.status == 1?'Open':'Close'}"/>
            </p:column>

            <p:column headerText="Action" width="70">
                <p:commandButton icon="ui-icon-edit" title="Pay" styleClass="AquaButton" onclick="PF('taxPayment').show()" rendered="#{tax.vatIn.doubleValue() != tax.vatOut.doubleValue()}">
                    <f:setPropertyActionListener value="#{tax}" target="#{taxTransactionController.taxTransaction}" />
                </p:commandButton>
            </p:column>

        </p:dataTable>

        <p:dialog widgetVar="taxPayment" header="Payment" 
                  resizable="false" 
                  draggable="false" 
                  modal="true"
                  responsive="true" 
                  hideEffect="scale">
            <div class="ui-g form-group" style="margin-bottom: 16px;">
                <div class="ui-g-12">
                    <p:panelGrid columns="4" 
                                 columnClasses="ui-grid-col-0,ui-grid-col-12" 
                                 layout="grid" 
                                 styleClass="ui-panelgrid-blank form-group"
                                 style="border:0px none; background-color:transparent;">

                        <p:outputLabel />
                        <h:panelGroup styleClass="md-inputfield">
                            <p:inputText value="#{taxTransactionController.taxTransaction.paidAmount}"/>
                            <label>Payment Amount</label>
                        </h:panelGroup>

                    </p:panelGrid>
                </div>

            </div>

            <f:facet name="footer">
                <p:commandButton 
                    action="#{taxTransactionController.save}"
                    value="Save"
                    update="@form"
                    onsuccess="PF('taxPayment').hide()" style="width:auto" 
                    icon="ui-icon-save"/>
            </f:facet>  

        </p:dialog>
    </h:form>
</div>