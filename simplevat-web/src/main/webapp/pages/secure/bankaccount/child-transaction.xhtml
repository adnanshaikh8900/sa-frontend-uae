<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui"
     xmlns:si="http://java.sun.com/jsf/composite/ccomponent">

    <style type="text/css">
        .ui-expanded-row-content td:first-child{
            padding:0px !important;
            border-left: 0 !important;
        }
        .ui-expanded-row-content td:last-child{
            border-right: 0 !important;
            border-top: 0 !important;
        }
        .innerTable thead th{
            /*display: none !important;*/
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            border: none !important;
        }
    </style>
    <p:dataTable var="childTransaction" rendered="#{transaction.childTransactionList.size() > 0}"
                 value="#{transaction.childTransactionList}"
                 rowIndexVar="index" styleClass="innerTable"
                 widgetVar="childTransactiondt"
                 rowExpandMode="single" 
                 rowKey="#{childTransaction.transactionId}" 
                 rows="4" id="childTransactionTable">
        <p:ajax event="rowToggle" listener="#{transactionListController.transactionViewLazyModel.expandToggler(childTransaction)}" process="@this"/>

        <p:column width="30" style="text-align: center">
            <h:panelGroup layout="block">
                <h:panelGroup layout="block" style="display:block" styleClass="label transtype-#{childTransaction.explanationStatusName}#{childTransaction.parent ? '': '-child'}" >
                    <h:outputText value=" "/>
                </h:panelGroup>
            </h:panelGroup>
        </p:column>

        <p:column width="80" >
            <h:outputText value="#{childTransaction.transactionDate.time}" >
                <f:convertDateTime pattern="dd/MM/yyyy" />
            </h:outputText>
        </p:column>

        <p:column >
            <p:outputLabel value="#{childTransaction.transactionDescription}"/><br/>
            <h:panelGroup rendered="#{childTransaction.explanationStatusCode != 2 and childTransaction.suggestedTransactionString.length() > 0}" >
                <p:outputLabel value="#{childTransaction.suggestedTransactionString}" style="font-size: x-small;color:#ff0000" /> 
                <p:spacer width="10px"/>
                <p:commandLink value=" Accept " action="#{transactionListController.acceptSuggestion(childTransaction)}" update="childTransactionTable:@row(#{index})" style="font-size: x-small; font-weight: bold;color:#14ad3c"/>
                <p:outputLabel value="/" />
                <p:commandLink value=" Edit" action="#{transactionListController.transactionViewLazyModel.expandToggler(childTransaction)}" update="childTransactionTable:@row(#{index})" style="font-size: x-small; font-weight: bold;color:#ff0000"/>
            </h:panelGroup>
            <h:panelGroup rendered="#{childTransaction.explanationStatusCode == 2}" >
                <p:outputLabel value="#{childTransaction.suggestedTransactionString}" style="font-size: x-small;color:#14ad3c" /> 
                <p:spacer width="10px"/>
                <p:commandLink value=" More" action="#{transactionListController.transactionViewLazyModel.expandToggler(childTransaction)}" update="childTransactionTable:@row(#{index})" style="font-size: x-small; font-weight: bold;color:#14ad3c" />
            </h:panelGroup>
        </p:column>

        <p:column width="110" styleClass="amount" >
            <h:outputText value="#{childTransaction.transactionAmount}" rendered="#{childTransaction.debitCreditFlag.toString() eq 'C'}" >
                <f:convertNumber type="currency" currencySymbol=""/>
            </h:outputText>
        </p:column>

        <p:column width="110" styleClass="amount" >
            <h:outputText value="#{childTransaction.transactionAmount}" rendered="#{childTransaction.debitCreditFlag.toString() eq 'D'}" >
                <f:convertNumber type="currency" currencySymbol=""/>
            </h:outputText>
        </p:column>

        <p:column  styleClass="amount" width="110">
            <h:outputText value="#{childTransaction.currentBalance}" >
                <f:convertNumber type="currency" currencySymbol=""/>
            </h:outputText>
        </p:column>

        <p:column width="130">

            <p:rowToggler/>
            <p:commandButton icon="#{childTransaction.expandIcon ? 'ui-icon-expand-less' : 'ui-icon-expand-more'}" onclick="childExpandCollapse(event, #{index})" action="#{transactionListController.expandCollapse(childTransaction)}" styleClass="AquaButton childExpandButton childRowExpand#{index}" update="childTransactionTable:@row(#{index}) @(.childExpandButton)"/>
            <p:commandButton icon="ui-icon-delete" styleClass="AquaButton" action="#{transactionListController.deleteTransaction}" update="childTransactionTable">
                <f:setPropertyActionListener value="#{childTransaction}" target="#{transactionListController.selectedTransactionViewModel}" />
                <p:confirm header="#{messages.delete}" message="#{messages.are_you_sure_want_to_delete}" icon="ui-icon-alert" />
            </p:commandButton>

        </p:column>

        <p:rowExpansion>
            <ui:include src="explainationExpantion.xhtml">
                <ui:param name="transaction" value="#{childTransaction}"/>
                <ui:param name="index" value="#{index}"/>
                <ui:param name="btnBinding" value="#{btnBinding}"/>
            </ui:include>
        </p:rowExpansion>
    </p:dataTable>
    <h:panelGroup id="PDF">
        <h:panelGroup  rendered="#{transaction.childTransactionList.size() == 0}" >
            <ui:include src="explainationExpantion.xhtml" >
                <ui:param name="transaction" value="#{transaction}"/>
                <ui:param name="index" value="#{index}"/>
                <ui:param name="btnBinding" value="#{btnBinding}"/>
            </ui:include>
        </h:panelGroup>
    </h:panelGroup>

    <!--    <script type="text/javascript">
            function expandCollapse(event, rowIndex) {
                $(".rowExpand" + rowIndex).parent().find('.ui-row-toggler').trigger('click');
                event.preventDefault();
            }
        </script>-->
</div>