<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui"
     xmlns:si="http://java.sun.com/jsf/composite/ccomponent">


    <p:panelGrid id="expansion" columns="1"
                 layout="grid" styleClass="ui-panelgrid-blank form-group">
        <p:panelGrid  columns="4" 
                      columnClasses="ui-grid-col-0, ui-grid-col-6, ui-grid-col-0, ui-grid-col-6"
                      layout="grid" styleClass="ui-panelgrid-blank form-group"
                      style="border:0px none; background-color:transparent; padding-top: 10px">
            <p:outputLabel for="transactionType1" />
            <h:panelGroup styleClass="md-inputfield">
                <p:autoComplete
                    id="transactionType1"
                    converter="#{transactionTypeConverter}"
                    dropdown="true"
                    forceSelection="true"
                    effect="fold"
                    scrollHeight="250"
                    groupBy="#{transactionType.parentTransactionType.transactionTypeName}"
                    completeMethod="#{transactionListController.transactionTypes(transaction.debitCreditFlag)}"
                    value="#{transactionViewLazyModel.expandedTransactionModel.transactionType}"
                    var="transactionType"
                    itemValue="#{transactionType}"
                    itemLabel="#{transactionType.transactionTypeName}">
                    <p:ajax update="transactionCategory1" event="itemSelect"  />
                </p:autoComplete>
                <label>#{messages.type}</label>
            </h:panelGroup>

            <p:outputLabel for="transactionCategory1" />
            <h:panelGroup styleClass="md-inputfield">
                <p:autoComplete
                    id="transactionCategory1"
                    converter="#{transactionCategoryConverter}"
                    dropdown="true"
                    forceSelection="true"
                    effect="fold" 
                    scrollHeight="250"
                    groupBy="#{(transactionCategory.parentTransactionCategory.transactionCategoryName != null)?transactionCategory.parentTransactionCategory.transactionCategoryName:'Others'}"
                    completeMethod="#{transactionListController.transactionCategories(transactionViewLazyModel.expandedTransactionModel.transactionType)}"
                    value="#{transactionViewLazyModel.expandedTransactionModel.explainedTransactionCategory}"
                    var="transactionCategory"
                    itemValue="#{transactionCategory}"
                    itemLabel="#{transactionCategory.transactionCategoryName}">
                    <p:ajax update="referancePanel referancePanelLabel" event="itemSelect" />
                </p:autoComplete>
                <label>#{messages.category}</label>
            </h:panelGroup>

            <p:outputLabel for="transactionDescription1" value=" "/>
            <h:panelGroup styleClass="md-inputfield">
                <p:inputText id="transactionDescription1"
                             value="#{transactionViewLazyModel.expandedTransactionModel.transactionDescription}" />
                <label>#{messages.description}</label>
            </h:panelGroup>
            <h:panelGroup id="referancePanelLabel">
                <p:outputLabel for="invoice1" rendered="#{transactionViewLazyModel.expandedTransactionModel.explainedTransactionCategory.transactionCategoryId == 1}"/>
                <p:outputLabel for="purchase1" rendered="#{transactionViewLazyModel.expandedTransactionModel.explainedTransactionCategory.parentTransactionCategory.transactionCategoryId == 43}"/>
            </h:panelGroup>
            <h:panelGroup id="referancePanel">
                <h:panelGroup id="InvoiceList" styleClass="md-inputfield" rendered="#{transactionViewLazyModel.expandedTransactionModel.explainedTransactionCategory.transactionCategoryId == 1}">
                    <p:autoComplete id="invoice1" converter="#{invoiceConverter}"
                                    dropdown="true"
                                    forceSelection="true"
                                    effect="fold" 
                                    scrollHeight="250"
                                    groupBy="#{(transaction.transactionAmount == invoice.dueAmount)?'Suggested':'Others'}"
                                    completeMethod="#{transactionListController.completeInvoice()}"
                                    value="#{transactionViewLazyModel.expandedTransactionModel.refObject}"
                                    var="invoice"
                                    itemValue="#{invoice}"
                                    itemLabel="#{invoice.invoiceReferenceNumber} : #{invoice.dueAmount} (#{invoice.invoiceContact.firstName})"
                                    required="true" requiredMessage="Please select invoice reference.">
                    </p:autoComplete>
                    <p:message for="invoice1" />
                    <label>Invoice Reference</label>
                </h:panelGroup>
                <h:panelGroup id="PurchaseList" styleClass="md-inputfield" rendered="#{transactionViewLazyModel.expandedTransactionModel.explainedTransactionCategory.parentTransactionCategory.transactionCategoryId == 43}">
                    <p:autoComplete id="purchase1" converter="#{purchaseConverter}"
                                    dropdown="true"
                                    forceSelection="true"
                                    effect="fold" 
                                    scrollHeight="250"
                                    groupBy="#{(transaction.transactionAmount == purchase.purchaseDueAmount)?'Suggested':'Others'}"
                                    completeMethod="#{transactionListController.completePurchase()}"
                                    value="#{transactionViewLazyModel.expandedTransactionModel.refObject}"
                                    var="purchase"
                                    itemValue="#{purchase}"
                                    itemLabel="#{purchase.receiptNumber} : #{purchase.purchaseDueAmount} (#{purchase.purchaseContact.firstName})"
                                    required="true" requiredMessage="Please select purchase reference.">
                    </p:autoComplete>
                    <p:message for="purchase1" />
                    <label>Purchase Reference</label>
                </h:panelGroup>
            </h:panelGroup>

        </p:panelGrid>
        <p:panelGrid  columns="3" 
                      columnClasses="ui-grid-col-1, ui-grid-col-1, ui-grid-col-1"
                      layout="grid" styleClass="ui-panelgrid-blank form-group">
            <p:commandButton value="#{messages.explain}" icon="ui-icon-save"
                             action="#{transactionListController.updateTransactionDropDown()}" update="@(.outerTable) @(.innerTable)">
                <f:setPropertyActionListener target="#{transactionListController.transactionModel}" value="#{transactionViewLazyModel.expandedTransactionModel}" />
            </p:commandButton>
            <p:commandButton value="#{messages.delete}" icon="ui-icon-delete"
                             action="#{transactionListController.deleteTransaction}">
                <f:setPropertyActionListener target="#{transactionListController.selectedTransactionViewModel}" value="#{transaction}" />
            </p:commandButton>
            <p:commandButton value="#{messages.cancel}" icon="ui-icon-cancel"
                             action="#{transactionListController.expandCollapse(transaction)}"/>
        </p:panelGrid>

    </p:panelGrid>
</div>